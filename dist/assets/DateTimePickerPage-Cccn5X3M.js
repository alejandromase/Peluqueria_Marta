import{d as Y,u as G,n as K,l as T,p as E,q as W,m as X,r as Z,c as i,o as l,b as o,s as a,e as A,x as ee,F as N,g as M,y as V,t as I,w as te,f as se}from"./index-pGSg9TIk.js";import{u as oe,Q as ne,g as ae}from"./main-DMqVBzYK.js";import{i as F,t as x,f as L}from"./dateUtils-BYq8WvRe.js";const re={class:"min-h-screen bg-gray-100 py-12 px-4 sm:px-6 lg:px-8"},ie={class:"max-w-3xl mx-auto"},le={class:"bg-white rounded-lg shadow-lg p-8"},de={key:0,class:"text-center py-8"},ue={key:1,class:"text-center py-8"},ce={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-8"},me={class:"space-y-4"},pe={class:"space-y-4"},ge={class:"space-y-6"},ve={class:"grid grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 p-2 bg-blue-50 rounded-lg"},fe=["onClick","disabled"],be={class:"grid grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 p-2 bg-orange-50 rounded-lg"},xe=["onClick","disabled"],ye={class:"mt-8 flex justify-end space-x-4"},he=["disabled"],Te=Y({__name:"DateTimePickerPage",setup(Se){const y=G(),R=K(),p=JSON.parse(localStorage.getItem("selectedService")||"{}").duration||0,{selectedDate:d,selectedTime:g,isLoading:$,error:B,selectTime:h,confirmSelection:P,loadSlots:v,isDayDisabled:H,availableTimes:S,workHours:r,minDate:Q,blockedDates:j,loadBlockedDates:q}=oe(),u=T(null),_=T(!1),k=n=>{const e=L(n);return!!(H(n)||j.value.some(s=>s.date===e&&s.blockType==="full"))},z=E(()=>{const[n]=r.value.morningStart.split(":").map(Number),[e]=r.value.morningEnd.split(":").map(Number);return S.value.filter(s=>{const t=parseInt(s.split(":")[0]);return t>=n&&t<e&&F(s,r.value.morningEnd,p)&&m(s)})}),J=E(()=>{const[n]=r.value.afternoonStart.split(":").map(Number),[e]=r.value.afternoonEnd.split(":").map(Number);return S.value.filter(s=>{const t=parseInt(s.split(":")[0]);return t>=n&&t<e&&F(s,r.value.afternoonEnd,p)&&m(s)})}),D=async n=>{_.value=!0;const e=L(n);u.value=await ae(e),_.value=!1};W(d,n=>{n&&D(new Date(n))});const m=n=>{if(!u.value)return!1;const s=parseInt(n.split(":")[0])<14;if(s&&u.value.blockedMorning||!s&&u.value.blockedAfternoon)return!1;const t=x(n),c=t+p,f=x(s?r.value.morningEnd:r.value.afternoonEnd);return c>f?!1:!(s?u.value.morningAppointments:u.value.afternoonAppointments).some(w=>{const b=x(w.time),C=b+w.duration;return t>=b&&t<C||c>b&&t<C})},O=()=>{const n=P();localStorage.setItem("lastPath","/datetime"),n&&(R.isAuthenticated?y.push("/reservation-details"):y.push("/auth/login"))},U=async()=>{const n=new Date,e=new Date(n);for(let s=0;s<30;s++){if(!k(e)){const t=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");d.value=`${t}-${c}-${f}`,await D(e);return}e.setDate(e.getDate()+1)}};return X(async()=>{await v(),await q(),setTimeout(U,100)}),(n,e)=>{const s=Z("RouterLink");return l(),i("div",re,[o("div",ie,[o("div",le,[e[9]||(e[9]=o("h1",{class:"text-3xl font-bold text-gray-900 mb-8"},"Selecciona fecha y hora",-1)),a($)?(l(),i("div",de,e[2]||(e[2]=[o("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"},null,-1),o("p",{class:"mt-4 text-gray-600"},"Cargando horarios disponibles...",-1)]))):a(B)?(l(),i("div",ue,[e[3]||(e[3]=o("p",{class:"text-red-600"}," Error al cargar los horarios disponibles. Por favor, inténtalo de nuevo. ",-1)),o("button",{onClick:e[0]||(e[0]=(...t)=>a(v)&&a(v)(...t)),class:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"}," Reintentar ")])):(l(),i("div",ce,[o("div",me,[e[4]||(e[4]=o("h2",{class:"text-xl font-semibold text-gray-900"},"Fecha",-1)),A(a(ne),{modelValue:a(d),"onUpdate:modelValue":e[1]||(e[1]=t=>ee(d)?d.value=t:null),"disabled-dates":k,"min-date":a(Q),inline:!0,"monday-first":!0,"enable-time-picker":!1,"auto-apply":!0,locale:"es",class:"p-2"},null,8,["modelValue","min-date"])]),o("div",pe,[e[7]||(e[7]=o("h2",{class:"text-xl font-semibold text-gray-900"},"Hora",-1)),o("div",ge,[o("div",null,[e[5]||(e[5]=o("h3",{class:"text-lg font-medium text-gray-700 mb-3"},"Mañana",-1)),o("div",ve,[(l(!0),i(N,null,M(z.value,t=>(l(),i("button",{key:t,onClick:c=>a(h)(t),class:V(["p-2 rounded-md text-center text-sm shadow-md",a(g)===t?"bg-[#1976D2] text-white":"hover:bg-gray-100 bg-blue-100"]),disabled:!m(t)},I(t),11,fe))),128))])]),o("div",null,[e[6]||(e[6]=o("h3",{class:"text-lg font-medium text-gray-700 mb-3"},"Tarde",-1)),o("div",be,[(l(!0),i(N,null,M(J.value,t=>(l(),i("button",{key:t,onClick:c=>a(h)(t),class:V(["p-2 rounded-md text-center text-sm shadow-md",a(g)===t?"bg-[#1976D2] text-white":"hover:bg-gray-100 bg-orange-100"]),disabled:!m(t)},I(t),11,xe))),128))])])])])])),o("div",ye,[A(s,{to:"/service",class:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"},{default:te(()=>e[8]||(e[8]=[se(" Volver")])),_:1,__:[8]}),o("button",{onClick:O,disabled:!a(d)||!a(g),class:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"}," Continuar ",8,he)])])])])}}});export{Te as default};
